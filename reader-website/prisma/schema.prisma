// prisma/schema.prisma - CORRIGIDO PARA SUPABASE
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USUÁRIOS - MAPEAR PARA TABELA users
// ============================================
model User {
  id                   String   @id @default(cuid())
  name                 String
  email                String   @unique
  phone                String?
  passwordHash         String?
  salt                 String?
  level                Int      @default(0)
  points               Int      @default(0)
  balance              Int      @default(0) // em centavos
  planType             PlanType @default(FREE)
  isAdmin              Boolean  @default(false)
  onboardingCompleted  Boolean  @default(false)
  commitment           Commitment?
  incomeRange          IncomeRange?
  profileImage         String?
  
  // Controle interno
  fraudScore           Int      @default(0)
  isSuspended          Boolean  @default(false)
  suspendedReason      String?
  conversionAttempts   Int      @default(0)
  lastLoginIP          String?
  lastLoginAt          DateTime?
  
  // Timestamps
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  
  @@map("users") // MAPEAR PARA TABELA users (minúscula)
}

// ============================================
// LIVROS - MAPEAR PARA TABELA books
// ============================================
model Book {
  id               String   @id @default(cuid())
  title            String   @unique
  author           String
  content          String?  @db.Text
  synopsis         String?  @db.Text
  genre            String
  coverImage       String?
  baseRewardMoney  Int      @default(1000) // em centavos
  rewardPoints     Int      @default(100)
  requiredLevel    Int      @default(0)
  estimatedReadTime Int     @default(480) // em segundos
  wordCount        Int      @default(1000)
  pageCount        Int      @default(1)
  reviewsCount     Int      @default(0)
  averageRating    Float    @default(0.0)
  totalReads       Int      @default(0)
  isInitialBook    Boolean  @default(false)
  active           Boolean  @default(true)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@map("books") // MAPEAR PARA TABELA books (minúscula)
}

// ============================================
// ENUMS
// ============================================
enum PlanType {
  FREE
  PREMIUM
}

enum Commitment {
  COMMITTED
  CURIOUS
}

enum IncomeRange {
  LOW
  MEDIUM
  HIGH
  UNEMPLOYED
}